<!doctype html>
<html lang="zh-CN" dir="ltr">

<head>
    <title>Medic可视化编辑器</title>
    <meta name="robots" content="noindex">
    <meta charset="utf-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="iframe" content="standalone">
</head>

<body>
    <!DOCTYPE html>

    <head>
        <script src="https://cdn.jsdelivr.net/gh/google/blockly/blockly_compressed.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/google/blockly/msg/js/zh-hans.js"></script>


        <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
        <script src="js/acorn_interpreter.js"></script>
        <script src="js/prettify-bundle.js"></script>
        <link href="styles/blockly_panel.css" rel="stylesheet">

        <!--引入块文件-->
        <script src="blocks/all.js"></script>
        <script src="blocks/api.js"></script>
        <script src="blocks/toolkit.js"></script>

        <script src="generators/all.js"></script>
        <script src="generators/api.js"></script>
        <script src="generators/toolkit.js"></script>
        <!--引入块结束-->
    </head>

    <body>
        <div class="app-container">
            <div id="blocklyDiv" class="main blockly-panel"></div>

            <div id="codeDiv" class="main output-panel">
                <div class="dropdown-bar">
                    Language:
                    <div id="im-just-an-underline">
                        <select id="languageDropdown" onChange="myUpdateFunction();">
                            <option value="JavaScript">JavaScript</option>
                        </select>
                    </div>
                </div>
                <hr class="POps">

            </div>
            <button class="clipboard-btn" data-clipboard-target=".code_output">复制</button>
            <a href="javascript:codeShow();" id="showButton" class="play-button material-icons"
                translate="no">play_arrow</a>
        </div>
        <xml xmlns="https://developers.google.com/blockly/xml" id="toolbox" style="display: none">
            <category name="杂项" colour="#66ccff">
                <block type="send"></block>
                <block type="sendmsg"></block>
                <block type="metext"></block>
                <block type="text_join"></block>
                <block type="math_number"></block>
                <block type="in_value"></block><block type="me_init"></block>
            </category>
            <category name="变量" colour="#a55b80" custom="VARIABLE"></category>
        </xml>
        <script>
            var workspace = Blockly.inject('blocklyDiv', {
                toolbox: document.getElementById('toolbox'),
                media: "http://www.532313.xyz:30/blockly/media/",
                grid: {
                    spacing: 20,
                    length: 3,
                    colour: '#ccc',
                    snap: true
                },
                zoom: {
                    controls: true,
                    wheel: true,
                    startScale: 1.0,
                    maxScale: 3,
                    minScale: 0.3,
                    scaleSpeed: 1.2
                },
                trashcan: true,
            });
            //var defaultBlocks = document.getElementById('blocklyDefault');
            //Blockly.Xml.domToWorkspace(defaultBlocks, workspace);

            function myUpdateFunction(event) {
                var languageDropdown = document.getElementById('languageDropdown');
                var languageSelection = languageDropdown.options[languageDropdown.selectedIndex].value;
                var codeDiv = document.getElementById('codeDiv');
                var codeHolder = document.createElement('textarea');
                codeHolder.className = 'code_output';

                var code = document.createTextNode(Blockly[languageSelection].workspaceToCode(workspace));
                codeHolder.appendChild(code);
                codeDiv.replaceChild(codeHolder, codeDiv.lastElementChild);
                //prettyPrint();
            }
            workspace.addChangeListener(myUpdateFunction);

            function codeShow() {
                document.getElementById("codeDiv").style.display = "block";
                document.getElementById("showButton").href = "javascript:codeHide()";
            }

            function codeHide() {
                document.getElementById("codeDiv").style.display = "none";
                document.getElementById("showButton").href = "javascript:codeShow()";
            }
            //document.getElementById('showButton').addEventListener('click', showCode);
            new ClipboardJS('.clipboard-btn');
        </script>
    </body>
</body>

</html>